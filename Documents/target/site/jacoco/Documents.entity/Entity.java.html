<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Entity.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">Documents</a> &gt; <a href="index.source.html" class="el_package">Documents.entity</a> &gt; <span class="el_source">Entity.java</span></div><h1>Entity.java</h1><pre class="source lang-java linenums">package Documents.entity;

import java.awt.Graphics2D;
import java.awt.image.BufferedImage;
import java.awt.Rectangle;
import javax.imageio.ImageIO;
import java.io.IOException;
import Documents.main.GamePanel;

/**
 * Represents an entity inside the maze.
 */
public class Entity {
	/** The GamePanel instance associated with the entity. */
	GamePanel gp;

	/** The x-coordinate for the entity. */
	public int wxPos;

	/** The y-coordinate for the entity. */
	public int wyPos;

	/** The velocity for the entity. */
	public int vel;

	/** The image for the entity facing upward motion 1. */
	public BufferedImage upward1;

	/** The image for the entity facing upward motion 2. */
	public BufferedImage upward2;

	/** The image for the entity facing downward motion 1. */
	public BufferedImage downward1;

	/** The image for the entity facing downward motion 2. */
	public BufferedImage downward2;

	/** The image for the entity facing leftward motion 1. */
	public BufferedImage leftward1;

	/** The image for the entity facing leftward motion 2. */
	public BufferedImage leftward2;

	/** The image for the entity facing rightward motion 1. */
	public BufferedImage rightward1;

	/** Another image for the entity facing rightward motion 2. */
	public BufferedImage rightward2;

	/** The direction of the entity facing into. */
	public String direction;

	/** Indicates if the Entities are on a path towards the main character. */
<span class="fc" id="L54">	public boolean onPath = false;</span>

<span class="fc" id="L56">	public int spriteCount = 0;</span>

	/** The number of sprites for the entity's movement animation. */
<span class="fc" id="L59">	public int spriteNum = 1;</span>

	/** The area used for collision detection with tiles. */
<span class="fc" id="L62">	public Rectangle detectionArea  = new Rectangle (0, 0, 48, 48);</span>

	/** The default x-coordinate for the detection area. */
	public int detectionDefaultX;

	/** The default y-coordinate for the detection area. */
	public int detectionDefaultY;

	/** Indicates the states whether the entity is currently collides with another entity. */
<span class="fc" id="L71">	public boolean isCollision = false;</span>

<span class="fc" id="L73">	public int actionLockCount = 0;</span>

<span class="fc" id="L75">	String dialogues[] = new String[20];</span>
<span class="fc" id="L76">	int dialogueIndex = 0;</span>

<span class="fc" id="L78">	public Entity (GamePanel gp) {</span>
<span class="fc" id="L79">		this.gp = gp;</span>
<span class="fc" id="L80">	}</span>


	public void setAction(){

<span class="fc" id="L85">	}</span>

	public void speak(){
<span class="fc bfc" id="L88" title="All 2 branches covered.">		if(dialogues[dialogueIndex] == null){</span>
<span class="fc" id="L89">			dialogueIndex = 0;</span>
		}
<span class="fc" id="L91">		gp.ui.currentDialogue = dialogues[dialogueIndex];</span>
<span class="fc" id="L92">		dialogueIndex++;</span>

<span class="fc bfc" id="L94" title="All 5 branches covered.">		switch(gp.mainCharacter.direction){</span>
			case &quot;up&quot;:
<span class="fc" id="L96">				direction = &quot;down&quot;;</span>
<span class="fc" id="L97">				break;</span>
			case &quot;down&quot;:
<span class="fc" id="L99">				direction = &quot;up&quot;;</span>
<span class="fc" id="L100">				break;</span>
			case &quot;left&quot;:
<span class="fc" id="L102">				direction = &quot;right&quot;;</span>
<span class="fc" id="L103">				break;</span>
			case &quot;right&quot;:
<span class="fc" id="L105">				direction = &quot;left&quot;;</span>
				break;
		}
<span class="fc" id="L108">	}</span>

	public void checkCollision() {
<span class="fc" id="L111">		isCollision = false;</span>
<span class="fc" id="L112">		gp.checkCollision.tileCheck(this);</span>
<span class="fc" id="L113">		gp.checkCollision.objCheck(this, false);</span>
<span class="fc" id="L114">		gp.checkCollision.playerCheck(this);</span>
<span class="fc" id="L115">		gp.checkCollision.entityCheck(this, gp.monster);</span>
<span class="fc" id="L116">	}</span>

	public void update(){
<span class="fc" id="L119">		setAction();</span>
<span class="fc" id="L120">		checkCollision();</span>

		//if its false, character can move else cannot
<span class="fc bfc" id="L123" title="All 2 branches covered.">		if(isCollision == false) {</span>
<span class="fc bfc" id="L124" title="All 5 branches covered.">			switch(direction) {</span>
<span class="fc" id="L125">				case &quot;up&quot;: this.wyPos -= this.vel; break;</span>
<span class="fc" id="L126">				case &quot;down&quot;: this.wyPos += this.vel; break;</span>
<span class="fc" id="L127">				case &quot;left&quot;: this.wxPos -= this.vel; break;</span>
<span class="fc" id="L128">				case &quot;right&quot;: this.wxPos += this.vel; break;</span>
			}
		}

		//animation
		//the move() method gets called 60 times per second
		//the spritecount gets increments 1 per frame and every 20 frames the sprite image change
<span class="fc" id="L135">		spriteCount++;</span>
<span class="fc bfc" id="L136" title="All 2 branches covered.">		if(spriteCount &gt; 10) {</span>
<span class="fc bfc" id="L137" title="All 2 branches covered.">			if(spriteNum == 1) {</span>
<span class="fc" id="L138">				spriteNum = 2;</span>
<span class="fc bfc" id="L139" title="All 2 branches covered.">			}else if(spriteNum == 2) {</span>
<span class="fc" id="L140">				spriteNum = 1;</span>
			}
<span class="fc" id="L142">			spriteCount = 0;</span>
		}
<span class="fc" id="L144">	}</span>

	public void draw(Graphics2D g2){
<span class="fc" id="L147">		BufferedImage image = null;</span>
<span class="fc" id="L148">		int screenX = wxPos - gp.mainCharacter.wxPos + gp.mainCharacter.screenX;</span>
<span class="fc" id="L149">		int screenY = wyPos - gp.mainCharacter.wyPos + gp.mainCharacter.screenY;</span>

		//checking if the tile is within the boundary
<span class="pc bpc" id="L152" title="4 of 8 branches missed.">		if(wxPos + gp.tileSize &gt; gp.mainCharacter.wxPos - gp.mainCharacter.screenX &amp;&amp;</span>
				wxPos - gp.tileSize &lt; gp.mainCharacter.wxPos + gp.mainCharacter.screenX &amp;&amp;
				wyPos + gp.tileSize &gt; gp.mainCharacter.wyPos - gp.mainCharacter.screenY &amp;&amp;
				wyPos - gp.tileSize &lt; gp.mainCharacter.wyPos + gp.mainCharacter.screenY) {
<span class="pc bpc" id="L156" title="1 of 5 branches missed.">			switch(direction) {</span>
				case &quot;up&quot;:
<span class="fc bfc" id="L158" title="All 2 branches covered.">					if(spriteNum == 1) {</span>
<span class="fc" id="L159">						image = upward1;</span>
					}
<span class="fc bfc" id="L161" title="All 2 branches covered.">					if(spriteNum == 2) {</span>
<span class="fc" id="L162">						image = upward2;</span>
					}
					break;
				case &quot;down&quot;:
<span class="fc bfc" id="L166" title="All 2 branches covered.">					if(spriteNum == 1) {</span>
<span class="fc" id="L167">						image = downward1;</span>
					}
<span class="fc bfc" id="L169" title="All 2 branches covered.">					if(spriteNum == 2) {</span>
<span class="fc" id="L170">						image = downward2;</span>
					}
					break;
				case &quot;left&quot;:
<span class="fc bfc" id="L174" title="All 2 branches covered.">					if(spriteNum == 1) {</span>
<span class="fc" id="L175">						image = leftward1;</span>
					}
<span class="fc bfc" id="L177" title="All 2 branches covered.">					if(spriteNum == 2) {</span>
<span class="fc" id="L178">						image = leftward2;</span>
					}
					break;
				case &quot;right&quot;:
<span class="fc bfc" id="L182" title="All 2 branches covered.">					if(spriteNum == 1) {</span>
<span class="fc" id="L183">						image = rightward1;</span>
					}
<span class="fc bfc" id="L185" title="All 2 branches covered.">					if(spriteNum == 2) {</span>
<span class="fc" id="L186">						image = rightward2;</span>
					}
					break;
			}
<span class="fc" id="L190">			g2.drawImage(image, screenX, screenY, gp.tileSize, gp.tileSize, null);</span>
		}
<span class="fc" id="L192">	}</span>
	public BufferedImage setup(String imgPath) {
<span class="fc" id="L194">		BufferedImage img = null;</span>

		try {
<span class="fc" id="L197">			img = ImageIO.read(getClass().getResourceAsStream(imgPath + &quot;.png&quot;));</span>
			//ensure the image supports alpha (transparency)
<span class="fc" id="L199">			BufferedImage newImg = new BufferedImage(gp.tileSize, gp.tileSize, BufferedImage.TYPE_INT_ARGB);</span>
<span class="fc" id="L200">			Graphics2D g2 = newImg.createGraphics();</span>
<span class="fc" id="L201">			g2.drawImage(img, 0, 0, gp.tileSize, gp.tileSize, null);</span>
<span class="fc" id="L202">			g2.dispose();</span>
<span class="fc" id="L203">			img = newImg;</span>
<span class="nc" id="L204">		}catch(IOException e) {</span>
<span class="nc" id="L205">			e.printStackTrace();</span>
<span class="fc" id="L206">		}</span>
<span class="fc" id="L207">		return img;</span>
	}

	public void searchPath(int goalColumn, int goalRow) {
<span class="fc" id="L211">		int startColumn = (wxPos + detectionArea.x)/gp.tileSize;</span>
<span class="fc" id="L212">		int startRow = (wyPos + detectionArea.y)/gp.tileSize;</span>

<span class="fc" id="L214">		gp.pFinder.setNode(startColumn, startRow, goalColumn, goalRow);</span>

<span class="pc bpc" id="L216" title="1 of 2 branches missed.">		if(gp.pFinder.search() == true) {</span>

			// Next wxPos and wyPos
<span class="fc" id="L219">			int nextX = gp.pFinder.pathList.get(0).column * gp.tileSize;</span>
<span class="fc" id="L220">			int nextY = gp.pFinder.pathList.get(0).row * gp.tileSize;</span>

			// Entity's solidArea position
<span class="fc" id="L223">			int enLeftX = wxPos + detectionArea.x;</span>
<span class="fc" id="L224">			int enRightX = wxPos + detectionArea.x + detectionArea.width;</span>
<span class="fc" id="L225">			int enTopY = wyPos + detectionArea.y;</span>
<span class="fc" id="L226">			int enBottomY = wyPos + detectionArea.y + detectionArea.height;</span>

<span class="pc bpc" id="L228" title="5 of 6 branches missed.">			if (enTopY &gt; nextY &amp;&amp; enLeftX &gt;= nextX &amp;&amp; enRightX &lt; nextX + gp.tileSize) {</span>
<span class="nc" id="L229">				direction = &quot;up&quot;;</span>
			}
<span class="pc bpc" id="L231" title="2 of 6 branches missed.">			else if (enTopY &lt; nextY &amp;&amp; enLeftX &gt;= nextX &amp;&amp; enRightX &lt; nextX + gp.tileSize) {</span>
<span class="fc" id="L232">				direction = &quot;down&quot;;</span>
			}
<span class="pc bpc" id="L234" title="3 of 4 branches missed.">			else if (enTopY &gt;= nextY &amp;&amp; enBottomY &lt; nextY + gp.tileSize) {</span>
<span class="nc bnc" id="L235" title="All 2 branches missed.">				if (enLeftX &gt; nextX) {</span>
<span class="nc" id="L236">					direction = &quot;left&quot;;</span>
				}
<span class="nc bnc" id="L238" title="All 2 branches missed.">				if (enLeftX &lt; nextX) {</span>
<span class="nc" id="L239">					direction = &quot;right&quot;;</span>
				}
			}
<span class="pc bpc" id="L242" title="3 of 4 branches missed.">			else if (enTopY &gt; nextY &amp;&amp; enLeftX &gt; nextX) {</span>
				//up or left
<span class="nc" id="L244">				direction = &quot;up&quot;;</span>
<span class="nc" id="L245">				checkCollision();</span>
<span class="nc bnc" id="L246" title="All 2 branches missed.">				if (isCollision == true) {</span>
<span class="nc" id="L247">					direction = &quot;left&quot;;</span>
				}
			}
<span class="pc bpc" id="L250" title="3 of 4 branches missed.">			else if (enTopY &gt; nextY &amp;&amp; enLeftX &lt; nextX) {</span>
<span class="nc" id="L251">				direction = &quot;up&quot;;</span>
<span class="nc" id="L252">				checkCollision();</span>
<span class="nc bnc" id="L253" title="All 2 branches missed.">				if (isCollision == true) {</span>
<span class="nc" id="L254">					direction = &quot;right&quot;;</span>
				}
			}
<span class="pc bpc" id="L257" title="2 of 4 branches missed.">			else if (enTopY &lt; nextY &amp;&amp; enLeftX &gt; nextX) {</span>
<span class="fc" id="L258">				direction = &quot;down&quot;;</span>
<span class="fc" id="L259">				checkCollision();</span>
<span class="pc bpc" id="L260" title="1 of 2 branches missed.">				if(isCollision == true) {</span>
<span class="nc" id="L261">					direction = &quot;left&quot;;</span>
				}
			}
<span class="nc bnc" id="L264" title="All 4 branches missed.">			else if (enTopY &lt; nextY &amp;&amp; enLeftX &lt; nextX) {</span>
<span class="nc" id="L265">				direction = &quot;down&quot;;</span>
<span class="nc" id="L266">				checkCollision();</span>
<span class="nc bnc" id="L267" title="All 2 branches missed.">				if (isCollision == true) {</span>
<span class="nc" id="L268">					direction = &quot;right&quot;;</span>
				}
			}

			// int nextColumn = gp.pFinder.pathList.get(0).column;
			// int nextRow = gp.pFinder.pathList.get(0).row;
			// if(nextColumn == goalColumn &amp;&amp; nextRow == goalRow) {
			// 	onPath = false;
			// }
		}
<span class="fc" id="L278">	}</span>
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.11.202310140853</span></div></body></html>